<!DOCTYPE html>

<html>
<head>
	<title>WebXR Test</title>
	<style>
		body { margin: 0; }
		canvas { width: 100%; height: 100% }
	</style>
</head>
	
<body>

<script type = "module">

import {
	BoxGeometry,
	Clock,
	Color,
	HemisphereLight,
	LineSegments,
	LineBasicMaterial,
	Mesh,
	MeshPhongMaterial,
	Scene,
	TextureLoader,
	WebGLRenderer,
	PerspectiveCamera
} from './three/build/three.module.js'

import { BoxLineGeometry} from './three/examples/jsm/geometries/BoxLineGeometry.js';
import { VRButton } from './three/examples/jsm/webxr/VRButton.js';

let camera, clock, scene, renderer, room, cube;

function onUpdate() {
	const delta = clock.getDelta();
	cube.rotateX(0.2 * delta);
	cube.rotateY(0.2 * delta);
	
	renderer.render(scene, camera);
}

function onWindowResize() {
	camera.aspect = window.innerWidth / window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize( window.innerWidth, window.innerHeight);
}

function init() {
	clock = new Clock();
	
	// scene
	
	scene = new Scene();
	scene.background = new Color(0x000000);
	
	// camera
	
	camera = new PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 30);
	camera.position.set(0, 1, 3);
	scene.add(camera);
	
	// room
	
	room = new LineSegments(
		new BoxLineGeometry(10, 6, 10, 10, 10, 10),
		new LineBasicMaterial( { color: 0x808080})
	);
	room.geometry.translate(0,3,0);
	scene.add(room);
	
	// light
	
	const light = new HemisphereLight( 0xffffff, 0x444444);
	light.position.set(1,1,1);
	scene.add(light);
	
	// renderer
	
	renderer = new WebGLRenderer( {antialias: true});
	renderer.setPixelRatio(window.devicePixelRatio);
	renderer.setSize(window.innerWidth, window.innerHeight);
	document.body.appendChild(renderer.domElement);

	// enable VR
	renderer.xr.enabled = true;
	document.body.appendChild( VRButton.createButton( renderer ) );	

	// objects
	
	const texture = new TextureLoader().load('images/pummel.png');
	texture.anisotropy = renderer.capabilities.getMaxAnisotropy();
	
	const geometry = new BoxGeometry(1,1,1);
	const material = new MeshPhongMaterial({color : 0x00ff00, map: texture});
	cube = new Mesh(geometry, material);
	cube.position.y = 1;
	scene.add(cube);

	// start
	
	window.addEventListener('resize', onWindowResize, false);
	renderer.setAnimationLoop(onUpdate);	
}

init();

</script>

</body>
</html>