<!-- Ten Minute Physics - Matthias Mueller -->

<!DOCTYPE html>
<html>

<head>
	<title>Bead on Wire</title>
	<style>
		.button {
		background-color: #606060;
		border: none;
		color: white;
		padding: 15px 32px;
		font-size: 16px;
		margin: 4px 2px;
		cursor: pointer;
	}
	</style>
</head>

<body>

<table style="width:100%">
	<tr>
		<td><button class="button" onclick="setupScene()">Restart</button></td>
	</tr>
	<tr>
		<td>
			<canvas id="myCanvas" style="border:2px solid"></canvas>
		</td>
	</tr>
</table>

<script>

	// drawing -------------------------------------------------------

	var canvas = document.getElementById("myCanvas");
	var c = canvas.getContext("2d");

	canvas.width = window.innerWidth - 20;
	canvas.height = window.innerHeight - 100;

	var simMinWidth = 2.0;
	var cScale = Math.min(canvas.width, canvas.height) / simMinWidth;
	var simWidth = canvas.width / cScale;
	var simHeight = canvas.height / cScale;

	function cX(pos) {
		return pos.x * cScale;
	}

	function cY(pos) {
		return canvas.height - pos.y * cScale;
	}

// vector math -------------------------------------------------------

	function vecCopy(a) {
		return { x : a.x, y : a.y };
	}

	function vecAdd(a, b, scale = 1.0) {
		return { x : a.x + scale * b.x, y : a.y + scale * b.y};
	}

	function vecSub(a, b, scale = 1.0) {
		return { x : a.x - scale * b.x, y : a.y - scale * b.y};
	}

	function vecScale(a, scale) {
		return { x : scale * a.x, y : scale * a.y}
	}

	function vecLength(a) {
		return Math.sqrt(a.x * a.x + a.y * a.y);
	}
	
	function vecDot(a, b) {
		return a.x * b.x + a.y * b.y;
	}

	// scene -------------------------------------------------------

	var gravity = { x: 0.0, y: -10.0};
	var numSteps = 10;
	var timeStep = 1.0 / 60.0 / numSteps;

	var wireCenter = { x: simWidth / 2.0, y: simHeight / 2.0};
	var wireRadius = simMinWidth * 0.4;

	var bead;

	function setupScene() 
	{
		bead = {
			radius : 0.1, 
			pos : {
				x : wireCenter.x + 0.0001, 
				y : wireCenter.y + wireRadius},
			prev : { x: 0, y : 0},
			vel : {x : 0.0, y : 0.0}
		}
	}

	// draw -------------------------------------------------------

	function draw() 
	{
		c.clearRect(0, 0, canvas.width, canvas.height);

		c.fillStyle = "#FF0000";
		c.lineWidth = 2.0;

		c.beginPath();
		c.arc(cX(wireCenter), cY(wireCenter), cScale * wireRadius, 0.0, 2.0 * Math.PI);
		c.stroke();

		c.fillStyle = "#FF0000";

		c.beginPath();			
		c.arc(
			cX(bead.pos), cY(bead.pos), cScale * bead.radius, 0.0, 2.0 * Math.PI); 
		c.closePath();
		c.fill();
	}

	function keepOnWire(bead) 
	{
		var dir = vecSub(bead.pos, wireCenter);
		var len = vecLength(dir);
		var corr = (wireRadius - len) / len;
		bead.pos = vecAdd(bead.pos, dir, corr);
	}

	function simulate() 
	{
		for (step = 0; step < numSteps; step++) {
			bead.vel = vecAdd(bead.vel, gravity, timeStep);
			bead.prev = vecCopy(bead.pos);
			bead.pos = vecAdd(bead.pos, bead.vel, timeStep);
			keepOnWire(bead);

			bead.vel = vecSub(bead.pos, bead.prev);
			bead.vel = vecScale(bead.vel, 1.0 / timeStep);
		}
	}

//	var time = 0.0;

	function update() {
		simulate();
		draw();
		requestAnimationFrame(update);
	}
	
	setupScene();
	update();
	
</script> 
</body>
</html>